<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>計算機基礎：數字系統與轉換 | 備考互動講義</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        },
                        cyan: {
                            400: '#22d3ee',
                            500: '#06b6d4',
                            900: '#164e63',
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 */
        }

        .card-hover {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        /* Flip Card Styles */
        .perspective { perspective: 1000px; }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            border-radius: 0.75rem;
            padding: 1.5rem;
        }
        .flip-card-back {
            transform: rotateY(180deg);
            background-color: #1e293b;
            border: 1px solid #22d3ee;
        }
        .flipped {
            transform: rotateY(180deg);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <header class="border-b border-slate-800 bg-slate-950/50 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <h1 class="text-2xl font-bold text-cyan-400 tracking-tight">
                計算機基礎 <span class="text-slate-500 font-normal">| 重點筆記與實戰演練</span>
            </h1>
            <p id="header-one-sentence" class="text-slate-400 text-sm mt-1"></p>
        </div>
    </header>

    <main class="flex-grow max-w-6xl mx-auto px-4 py-8 space-y-12 w-full">

        <section id="dashboard" class="space-y-6 animate-fade-in">
            <div class="flex items-center space-x-2 mb-4">
                <div class="w-1 h-6 bg-cyan-400 rounded"></div>
                <h2 class="text-xl font-bold text-white">戰略儀表板</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-2 bg-slate-800 rounded-xl p-6 border border-slate-700">
                    <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4">考試權重與出題熱區</h3>
                    <div id="weighting-container" class="space-y-4">
                        </div>
                </div>

                <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 flex flex-col justify-between">
                    <div>
                        <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">先備知識</h3>
                        <ul id="prereqs-list" class="list-disc list-inside text-slate-300 text-sm space-y-1 mb-6"></ul>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">後續連結</h3>
                        <div id="downstream-list" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </div>

            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4">核心關鍵字 (點擊查看考點)</h3>
                <div id="keywords-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    </div>
            </div>
        </section>

        <section id="lab" class="space-y-6">
            <div class="flex items-center space-x-2 mb-4">
                <div class="w-1 h-6 bg-cyan-400 rounded"></div>
                <h2 class="text-xl font-bold text-white">核心觀念實驗室：<span id="lab-title"></span></h2>
            </div>
            
            <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                <div class="p-6 bg-slate-850 border-b border-slate-700">
                    <p class="text-slate-300 mb-4" id="lab-objective"></p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div class="md:col-span-2">
                            <label class="block text-xs text-slate-400 mb-1">輸入數值</label>
                            <input type="text" id="calc-input" class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-white focus:border-cyan-400 focus:outline-none font-mono" placeholder="例如: 25.625">
                        </div>
                        <div>
                            <label class="block text-xs text-slate-400 mb-1">來源基底</label>
                            <select id="calc-source" class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-white focus:border-cyan-400 focus:outline-none">
                                <option value="10">十進位 (10)</option>
                                <option value="2">二進位 (2)</option>
                                <option value="8">八進位 (8)</option>
                                <option value="16">十六進位 (16)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-slate-400 mb-1">目標基底</label>
                            <select id="calc-target" class="w-full bg-slate-900 border border-slate-600 rounded px-3 py-2 text-white focus:border-cyan-400 focus:outline-none">
                                <option value="2">二進位 (2)</option>
                                <option value="10">十進位 (10)</option>
                                <option value="8">八進位 (8)</option>
                                <option value="16">十六進位 (16)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2">
                    <div class="p-6 border-r border-slate-700 border-b lg:border-b-0">
                        <h4 class="text-cyan-400 font-bold mb-3">運算過程詳解</h4>
                        <div id="calc-steps" class="space-y-3 text-sm text-slate-300 font-mono h-64 overflow-y-auto pr-2 custom-scrollbar">
                            <p class="text-slate-500 italic">請輸入數值開始運算...</p>
                        </div>
                        <div class="mt-4 pt-4 border-t border-slate-700">
                            <p class="text-xs text-slate-400 uppercase">最終結果</p>
                            <p id="calc-result" class="text-2xl font-bold text-white font-mono mt-1">-</p>
                        </div>
                    </div>

                    <div class="p-6 bg-slate-850/50">
                        <h4 class="text-red-400 font-bold mb-3 flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                            常見陷阱警示
                        </h4>
                        <div id="mistakes-container" class="space-y-3">
                            </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="matrix" class="space-y-6">
            <div class="flex items-center space-x-2 mb-4">
                <div class="w-1 h-6 bg-cyan-400 rounded"></div>
                <h2 class="text-xl font-bold text-white" id="matrix-title"></h2>
            </div>

            <div class="bg-slate-800 rounded-xl border border-slate-700 p-6">
                <div class="flex flex-wrap gap-2 mb-6" id="matrix-dimensions">
                    </div>

                <div class="overflow-x-auto rounded-lg border border-slate-600">
                    <table class="w-full text-left text-sm text-slate-300">
                        <thead class="bg-slate-900 text-xs uppercase text-slate-400 font-bold">
                            <tr>
                                <th class="px-6 py-3 border-b border-slate-600">系統名稱</th>
                                </tr>
                        </thead>
                        <tbody id="matrix-body" class="divide-y divide-slate-700">
                            </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="drill" class="space-y-12">
            <div class="space-y-6">
                <div class="flex items-center space-x-2 mb-4">
                    <div class="w-1 h-6 bg-cyan-400 rounded"></div>
                    <h2 class="text-xl font-bold text-white">閃示卡 (Flashcards)</h2>
                </div>
                <div id="flashcards-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    </div>
            </div>

            <div class="space-y-6">
                <div class="flex items-center space-x-2 mb-4">
                    <div class="w-1 h-6 bg-cyan-400 rounded"></div>
                    <h2 class="text-xl font-bold text-white">情境判斷 (Scenario Check)</h2>
                </div>
                <div id="scenario-container" class="space-y-4">
                    </div>
            </div>
        </section>

        <section id="appendix" class="border-t border-slate-800 pt-8">
            <details class="group bg-slate-900 rounded-xl border border-slate-800">
                <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4 text-slate-400 hover:text-cyan-400 transition-colors">
                    <span>附錄：我的原始筆記 (Raw Notes)</span>
                    <span class="transition group-open:rotate-180">
                        <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24"><path d="M6 9l6 6 6-6"></path></svg>
                    </span>
                </summary>
                <div class="text-slate-400 mt-0 px-4 pb-4">
                    <pre id="raw-notes" class="whitespace-pre-wrap font-mono text-sm bg-slate-950 p-4 rounded-lg overflow-x-auto border border-slate-800"></pre>
                </div>
            </details>
        </section>

    </main>

    <footer class="border-t border-slate-800 bg-slate-900 mt-12 py-8 text-center text-slate-500 text-sm">
        <p>&copy; 2025 Education Tech. Generated based on user notes.</p>
    </footer>

    <script>
        // === STEP 1: DATA INJECTION ===
        const data = {
          "chapter_positioning": {
            "one_sentence": "本章作為「人機溝通的翻譯機制」，建立從十進位思維切換至二進位思維的基礎，是理解後續硬體架構與資料結構的絕對前提。",
            "prerequisites": [
              "基礎算術（加減乘除）",
              "指數與權重概念"
            ],
            "downstream_links": [
              "補數運算 (1-6)",
              "浮點數 IEEE 754 (1-7)",
              "記憶體定址 (第三章)",
              "數位邏輯設計"
            ]
          },
          "keywords": [
            {
              "term": "二進位 (Binary)",
              "why_important": "電腦硬體元件（如電晶體）僅有開/關兩種狀態，是機器運作的最自然語言。",
              "common_exam_angle": "基礎數值轉換、與邏輯閘運算的結合。"
            },
            {
              "term": "十六進位 (Hexadecimal)",
              "why_important": "作為二進位的簡寫形式（4位元一組），大幅簡化位址（Address）與長字串的讀寫。",
              "common_exam_angle": "記憶體位址計算、MAC Address、色彩編碼表示，特別是 A-F 的數值對應。"
            },
            {
              "term": "展開式 (Polynomial Expansion)",
              "why_important": "N 進位轉十進位的通用數學模型，透過「數字 × 權重」求和。",
              "common_exam_angle": "計算特定位數的權重值（Weight），或反推基底 N。"
            },
            {
              "term": "截尾誤差 (Truncation Error)",
              "why_important": "十進位小數轉二進位時可能產生「無限循環」，導致電腦無法精確儲存。",
              "common_exam_angle": "判斷哪些小數無法精確轉換（如 0.633），連結浮點數精確度問題。"
            }
          ],
          "weighting": {
            "basis": "notes",
            "items": [
              {
                "topic": "二、八、十、十六進位互轉",
                "weight": 90,
                "reason": "歷年必考題型，要求高精準度與速度，是基本分來源。"
              },
              {
                "topic": "小數點轉換與誤差",
                "weight": 70,
                "reason": "涉及無限循環與截尾誤差概念，是連結浮點數章節的關鍵。"
              },
              {
                "topic": "基底與權重概念",
                "weight": 50,
                "reason": "理解進位系統的理論基礎，多用於觀念題或反求基底題型。"
              }
            ]
          },
          "comparison_matrix": {
            "title": "四大數字系統特性與轉換邏輯比較",
            "dimensions": [
              "基底 (Base)",
              "使用符號",
              "主要用途/視角",
              "與二進位轉換捷徑"
            ],
            "rows": [
              {
                "name": "十進位 (Decimal)",
                "values": {
                  "基底 (Base)": "10",
                  "使用符號": "0-9",
                  "主要用途/視角": "人類視角、日常生活、數學運算基礎",
                  "與二進位轉換捷徑": "無捷徑 (需透過除法/乘法或展開式)"
                },
                "pitfall": "誤以為電腦內部儲存也是十進位",
                "rule_of_thumb": "整數連除取餘數、小數連乘取整數"
              },
              {
                "name": "二進位 (Binary)",
                "values": {
                  "基底 (Base)": "2",
                  "使用符號": "0, 1",
                  "主要用途/視角": "機器視角、硬體電路狀態",
                  "與二進位轉換捷徑": "本體 (無需轉換)"
                },
                "pitfall": "位數過多易讀錯或寫錯",
                "rule_of_thumb": "電腦的母語"
              },
              {
                "name": "八進位 (Octal)",
                "values": {
                  "基底 (Base)": "8",
                  "使用符號": "0-7",
                  "主要用途/視角": "二進位縮寫 (早期電腦、Linux權限)",
                  "與二進位轉換捷徑": "3位一組 (2^3 = 8)"
                },
                "pitfall": "看到數字 8 或 9 出現 (非法符號)",
                "rule_of_thumb": "421 分組法"
              },
              {
                "name": "十六進位 (Hexadecimal)",
                "values": {
                  "基底 (Base)": "16",
                  "使用符號": "0-9, A-F",
                  "主要用途/視角": "工程師折衷視角、記憶體位址、RGB色彩",
                  "與二進位轉換捷徑": "4位一組 (2^4 = 16)"
                },
                "pitfall": "忘記 A=10, F=15，運算時進位錯誤",
                "rule_of_thumb": "8421 分組法"
              }
            ]
          },
          "core_concept_lab": {
            "chosen_concept": "進位轉換演算法 (The Conversion Algorithms)",
            "type": "calculator",
            "learning_objective": "理解並熟練「整數除法取餘」、「小數乘法取整」及「二/八/十六分組」的三種不同轉換邏輯。",
            "inputs": [
              { "id": "input_val", "default": "25.625" },
              { "id": "source_base", "default": "10" },
              { "id": "target_base", "default": "2" }
            ],
            "common_mistakes": [
              {
                "mistake": "十轉二時，餘數讀取方向錯誤",
                "why_wrong": "整數應由下往上 (MSB在下)，小數應由上往下 (MSB在上)。",
                "how_to_fix": "口訣：整數逆流而上，小數順流而下。"
              },
              {
                "mistake": "十六進位運算直接寫 10, 11...",
                "why_wrong": "十六進位單一位數最大只能是 F (15)，超過 9 必須轉英文。",
                "how_to_fix": "看到 10~15 直覺反應 A~F。"
              }
            ]
          },
          "flashcards": [
            {
              "front": "十六進位 (Hex) A~F 對應數值",
              "back": "A=10, B=11, C=12, D=13, E=14, F=15。<br>考點：記憶體位址運算時常需先轉回十進位計算。"
            },
            {
              "front": "小數轉二進位的「無限循環」現象",
              "back": "如 0.633 等無法用 2^-n 組合精確表示的小數，會產生無限位數。<br>考點：這是「截尾誤差」的來源，也是浮點數不精確的主因。"
            },
            {
              "front": "八進位與十六進位的分組規則",
              "back": "八進位：3 位二進位一組 (2^3=8)<br>十六進位：4 位二進位一組 (2^4=16)<br>考點：不足位數需補 0，整數補左邊，小數補右邊。"
            },
            {
              "front": "展開式 (Polynomial Expansion)",
              "back": "將數值依「位數」拆解為「數字 × 基底^權重」之總和。<br>考點：N 進位轉十進位的標準算法。"
            }
          ],
          "scenario_checks": [
            {
              "statement": "將十六進位 (3AB) 轉為八進位時，最快的方法是先轉成十進位再轉八進位。",
              "answer": "X",
              "explanation": "錯誤。最快路徑是透過「二進位」作為橋樑：先將 Hex 展成 4位一組 Binary，再重組為 3位一組轉 Octal。"
            },
            {
              "statement": "所有有限位數的十進位小數（如 0.5, 0.25），轉換成二進位後也一定是有限小數。",
              "answer": "X",
              "explanation": "錯誤。例如 0.1 (Decimal) 轉二進位會變成 0.000110011... 無限循環。只有數值為 2^-n 組合時才會是有限小數。"
            },
            {
              "statement": "在電腦科學中，使用十六進位的主要原因是電腦硬體內部是十六進位架構。",
              "answer": "X",
              "explanation": "錯誤。電腦內部硬體是「二進位」。使用十六進位是為了讓「人類」工程師更容易閱讀與書寫過長的二進位字串。"
            }
          ],
          "original_notes_for_appendix": "在「第一章 計算機基礎」的宏觀背景下，來源資料將**「數字系統之基底 (1-4)」與「不同進位數間之互換 (1-5)」視為人與電腦溝通的「翻譯機制」**。\n這部分內容在教材中扮演著「解碼器」的角色，其核心觀點可以從以下四個層面來探討：\n1. 溝通的隔閡：定義「人類」與「機器」的語言邊界\n來源資料首先確立了為什麼我們需要學習不同的數字系統。\n• 人類的視角：我們習慣使用十進位 (Decimal)，這也是我們日常生活和數學運算的基礎。\n• 機器的視角：電腦內部元件（如電晶體）只有「開」與「關」兩種狀態，因此最自然的語言是二進位 (Binary)。\n• 工程師的折衷：來源指出，因為二進位數字太長（例如 11111111），不易閱讀與書寫，因此引入了八進位 (Octal) 和 十六進位 (Hexadecimal) 作為二進位的簡寫形式。特別是十六進位，使用 0-9 和 A-F 來表示，這在後續章節（如記憶體位址、MAC Address、色彩編碼）中將反覆出現。\n2. 核心運算邏輯：轉換的演算法\n來源資料將進位轉換視為一種嚴謹的數學演算（Algorithm），並將其分為兩大類邏輯，這直接呼應了 1-2 節對演算法「明確性」的要求：\n• 十進位 ↔ N 進位（翻譯的核心）：\n    ◦ 十轉 N：來源詳細展示了**「整數用除法（取餘數）、小數用乘法（取整數）」**的規則。這裡特別強調了小數轉換可能產生的「無限循環」問題（如 0.633 轉二進位），這為後續 1-7 節討論的「截尾誤差」埋下了伏筆。\n    ◦ N 轉十：使用**「展開式 (Polynomial Expansion)」**，將每個位數乘以其權重（Weight）後相加。\n• 二、八、十六進位間的互換（捷徑）：\n    ◦ 來源特別強調這三者之間存在**「次方關係」**（2^3=8, 2^4=16）。\n    ◦ 因此，轉換不需要經過十進位，而是透過**「分組」**（3 位一組或 4 位一組）來直接對應。這種方法被視為考試中的「速解法」，也是電腦科學特有的處理方式。\n3. 考試策略定位：必拿的基本分\n在「計算機概論高分策略」中，作者明確指出「數字系統（含2、8、10、16進位轉換）」是歷年來**「必考之題型」**。\n• 這意味著在第一章的學習策略中，這部分不容許模糊。學生必須能夠熟練處理如 (3AB)16 轉換為十進位，或是小數點後的二進位轉換等題目,。\n• 題庫顯示，這類題目通常測試計算的精準度，例如詢問 (11011.101)2 等於多少十進位數值。\n4. 為後續章節鋪路\n這部分內容是後續多個章節的基礎：\n• 連結補數 (1-6)：如果不理解二進位，就無法進行補數運算，也無法理解電腦如何處理負數,。\n• 連結浮點數 (1-7)：IEEE 754 標準完全依賴二進位的科學記號表示法，若不懂基底轉換，將無法理解浮點數的儲存格式。\n• 連結記憶體定址 (第三章)：後續在談論記憶體位址（Address）時，通常使用十六進位表示（例如 0xFFFF），這需要本章的知識作為支撐,。\n總結\n在來源資料的觀點中，「數字系統之基底與互換」不僅是數學計算，它是電腦科學的「字母表」。教材透過這兩節課，訓練學生從「十進位思維」切換到「二進位思維」，這是理解電腦硬體架構（Hardware Architecture）與資料結構（Data Structure）的絕對前提。"
        };

        // === STEP 2: RENDER FUNCTIONS ===

        function initDashboard() {
            document.getElementById('header-one-sentence').textContent = data.chapter_positioning.one_sentence;
            
            // Weighting
            const weightContainer = document.getElementById('weighting-container');
            data.weighting.items.forEach((item, idx) => {
                const opacity = idx === 0 ? 'bg-cyan-400' : (idx === 1 ? 'bg-cyan-600' : 'bg-cyan-800');
                const html = `
                    <div class="space-y-1 group relative">
                        <div class="flex justify-between text-xs text-slate-300">
                            <span>${item.topic}</span>
                            <span>${item.weight}%</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-2">
                            <div class="${opacity} h-2 rounded-full transition-all duration-1000" style="width: ${item.weight}%"></div>
                        </div>
                        <div class="hidden group-hover:block absolute top-6 left-0 z-10 p-2 bg-slate-900 border border-slate-600 rounded shadow-lg text-xs text-slate-200 w-64">
                            ${item.reason}
                        </div>
                    </div>
                `;
                weightContainer.innerHTML += html;
            });

            // Prerequisites
            const preList = document.getElementById('prereqs-list');
            data.chapter_positioning.prerequisites.forEach(p => {
                preList.innerHTML += `<li>${p}</li>`;
            });

            // Downstream
            const downList = document.getElementById('downstream-list');
            data.chapter_positioning.downstream_links.forEach(d => {
                downList.innerHTML += `<span class="bg-slate-700 text-slate-300 px-2 py-1 rounded text-xs border border-slate-600">${d}</span>`;
            });

            // Keywords
            const kwContainer = document.getElementById('keywords-container');
            data.keywords.forEach((kw, idx) => {
                const html = `
                    <div class="card-hover bg-slate-750 p-4 rounded-lg border border-slate-700 cursor-pointer hover:border-cyan-400 group relative" onclick="this.classList.toggle('active')">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-white">${kw.term}</h4>
                            <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <div class="hidden group-hover:block sm:group-[.active]:block text-xs text-slate-400 mt-2 space-y-2">
                            <p><span class="text-cyan-400">重要性：</span>${kw.why_important}</p>
                            <p><span class="text-yellow-500">考點：</span>${kw.common_exam_angle}</p>
                        </div>
                    </div>
                `;
                kwContainer.innerHTML += html;
            });
        }

        function initLab() {
            document.getElementById('lab-title').textContent = data.core_concept_lab.chosen_concept;
            document.getElementById('lab-objective').textContent = data.core_concept_lab.learning_objective;
            
            // Set defaults
            const inputs = data.core_concept_lab.inputs;
            document.getElementById('calc-input').value = inputs[0].default;
            document.getElementById('calc-source').value = inputs[1].default;
            document.getElementById('calc-target').value = inputs[2].default;

            // Render mistakes
            const mistakesContainer = document.getElementById('mistakes-container');
            data.core_concept_lab.common_mistakes.forEach(m => {
                mistakesContainer.innerHTML += `
                    <div class="bg-red-900/20 border-l-4 border-red-500 p-3 rounded-r">
                        <p class="text-white font-bold text-sm mb-1">${m.mistake}</p>
                        <p class="text-slate-400 text-xs mb-1">錯誤原因: ${m.why_wrong}</p>
                        <p class="text-green-400 text-xs">修正: ${m.how_to_fix}</p>
                    </div>
                `;
            });

            // Attach listeners
            ['calc-input', 'calc-source', 'calc-target'].forEach(id => {
                document.getElementById(id).addEventListener('input', runCalculation);
            });

            // Initial run
            runCalculation();
        }

        function runCalculation() {
            const inputVal = document.getElementById('calc-input').value.trim();
            const sourceBase = parseInt(document.getElementById('calc-source').value);
            const targetBase = parseInt(document.getElementById('calc-target').value);
            const stepsDiv = document.getElementById('calc-steps');
            const resultDiv = document.getElementById('calc-result');

            stepsDiv.innerHTML = '';

            if (!inputVal) {
                resultDiv.textContent = '-';
                return;
            }

            // Simple validation
            const validChars = {
                2: /^[0-1.]+$/,
                8: /^[0-7.]+$/,
                10: /^[0-9.]+$/,
                16: /^[0-9A-Fa-f.]+$/
            };
            if (!validChars[sourceBase].test(inputVal)) {
                resultDiv.textContent = "輸入格式錯誤 (含有非法字元)";
                stepsDiv.innerHTML = `<p class="text-red-400">錯誤：基底 ${sourceBase} 不應包含此字元。</p>`;
                return;
            }

            // Calculation Logic & Steps
            try {
                let htmlSteps = '';
                
                // Parse Input (Integer and Fraction)
                let [intPartStr, fracPartStr] = inputVal.split('.');
                let intVal = parseInt(intPartStr, sourceBase);
                let fracVal = 0;
                
                // --- STRATEGY SELECTION ---
                // 1. Grouping Strategy (2 <-> 8 <-> 16)
                const isGroupable = [2, 8, 16].includes(sourceBase) && [2, 8, 16].includes(targetBase);
                
                if (isGroupable) {
                    htmlSteps += `<p class="text-cyan-300 mb-2 font-bold">使用「分組策略」(Grouping Strategy)</p>`;
                    htmlSteps += `<p>1. 這是基底 ${sourceBase} 與 ${targetBase} 的互轉，存在次方關係。</p>`;
                    htmlSteps += `<p>2. 不需經過十進位，直接進行位元對應。</p>`;
                    
                    // Convert via Binary as bridge for display logic simplification
                    let binaryInt = parseInt(intPartStr, sourceBase).toString(2);
                    htmlSteps += `<div class="mt-2 bg-slate-900 p-2 rounded">中間二進位：${binaryInt}</div>`;
                    
                    let result = parseInt(intPartStr, sourceBase).toString(targetBase).toUpperCase();
                    if(fracPartStr) {
                         // Rough approximation for display
                         result += ".[小數處理]"; 
                         htmlSteps += `<p class="text-xs text-slate-500 mt-2">*小數部分同樣依循分組規則</p>`;
                    }
                    resultDiv.textContent = result;
                } 
                // 2. Polynomial Expansion (N -> 10)
                else if (targetBase === 10) {
                    htmlSteps += `<p class="text-cyan-300 mb-2 font-bold">使用「展開式」(Polynomial Expansion)</p>`;
                    let expansionStr = [];
                    // Int part
                    for(let i=0; i<intPartStr.length; i++) {
                        let digit = parseInt(intPartStr[i], sourceBase);
                        let power = intPartStr.length - 1 - i;
                        expansionStr.push(`(${digit} × ${sourceBase}<sup>${power}</sup>)`);
                    }
                    htmlSteps += `<p>整數：${expansionStr.join(' + ')}</p>`;
                    // Frac part (simplified)
                    if (fracPartStr) {
                        htmlSteps += `<p>小數：依序乘上 ${sourceBase}<sup>-1</sup>, ${sourceBase}<sup>-2</sup>...</p>`;
                    }
                    
                    // Actual calc (using built-in for simplicity, watch out for precision)
                    let total = parseInt(intPartStr, sourceBase);
                    if (fracPartStr) {
                        // Manual loop for precision visualization
                        let fracTotal = 0;
                        for(let i=0; i<fracPartStr.length; i++) {
                            fracTotal += parseInt(fracPartStr[i], sourceBase) * Math.pow(sourceBase, -(i+1));
                        }
                        total += fracTotal;
                    }
                    resultDiv.textContent = total;
                }
                // 3. Division/Multiplication (10 -> N)
                else if (sourceBase === 10) {
                    htmlSteps += `<p class="text-cyan-300 mb-2 font-bold">整數連除 / 小數連乘</p>`;
                    
                    // Int: Division
                    let tempInt = parseInt(intPartStr);
                    let divSteps = [];
                    while (tempInt > 0) {
                        let rem = tempInt % targetBase;
                        let quot = Math.floor(tempInt / targetBase);
                        divSteps.push(`${tempInt} ÷ ${targetBase} = ${quot} ... 餘 ${rem}`);
                        tempInt = quot;
                    }
                    htmlSteps += `<div class="mb-2"><p class="font-bold text-slate-400">整數部分 (由下往上讀):</p>${divSteps.join('<br>')}</div>`;

                    // Frac: Mult
                    let resultFrac = "";
                    if (fracPartStr) {
                        let tempFrac = parseFloat("0." + fracPartStr);
                        let multSteps = [];
                        let limit = 5; // Prevent infinite
                        htmlSteps += `<div class="mb-2"><p class="font-bold text-slate-400">小數部分 (由上往下讀):</p>`;
                        while (tempFrac > 0 && limit > 0) {
                            let next = tempFrac * targetBase;
                            let intBit = Math.floor(next);
                            tempFrac = next - intBit;
                            multSteps.push(`${next.toFixed(4)} → 取整數 <strong>${intBit}</strong>`);
                            resultFrac += intBit.toString(targetBase);
                            limit--;
                        }
                        if (tempFrac > 0) {
                            multSteps.push("... (可能產生無限循環/截尾誤差)");
                            resultFrac += "...";
                        }
                        htmlSteps += multSteps.join('<br>') + `</div>`;
                    }
                    
                    let resultInt = parseInt(intPartStr).toString(targetBase).toUpperCase();
                    resultDiv.textContent = resultFrac ? `${resultInt}.${resultFrac}` : resultInt;
                }
                // 4. General N -> M (via 10)
                else {
                    htmlSteps += `<p class="text-yellow-400 mb-2">通用路徑：${sourceBase} → 10 → ${targetBase}</p>`;
                    htmlSteps += `<p>1. 先將 ${sourceBase} 進位轉為 10 進位。</p>`;
                    htmlSteps += `<p>2. 再將 10 進位轉為 ${targetBase} 進位。</p>`;
                    
                    // Calc
                    let intVal10 = parseInt(intPartStr, sourceBase);
                    let result = intVal10.toString(targetBase).toUpperCase();
                    resultDiv.textContent = result + (fracPartStr ? ".[小數]" : "");
                }

                stepsDiv.innerHTML = htmlSteps;

            } catch (e) {
                resultDiv.textContent = "運算錯誤";
                console.error(e);
            }
        }

        function initMatrix() {
            document.getElementById('matrix-title').textContent = data.comparison_matrix.title;
            
            // Render Headers (Rows are systems, Cols are dimensions)
            // But JSON structure is: Rows = [Decimal, Binary...], Row.Values = {Base: 10, Symbol: 0-9...}
            // Let's create columns based on dimensions
            const tableHead = document.querySelector('#matrix thead tr');
            const dimContainer = document.getElementById('matrix-dimensions');
            const matrixBody = document.getElementById('matrix-body');

            // Dimensions Chips & Table Headers
            data.comparison_matrix.dimensions.forEach((dim, idx) => {
                // Header
                const th = document.createElement('th');
                th.className = "px-6 py-3 border-b border-slate-600 cursor-pointer hover:text-cyan-400 transition-colors";
                th.textContent = dim;
                th.onclick = () => highlightColumn(idx + 1); // +1 because first col is Name
                tableHead.appendChild(th);

                // Chip
                const chip = document.createElement('button');
                chip.className = "px-3 py-1 rounded-full text-xs font-medium border border-slate-600 bg-slate-800 text-slate-300 hover:border-cyan-400 hover:text-cyan-400 transition";
                chip.textContent = dim;
                chip.onclick = () => highlightColumn(idx + 1);
                dimContainer.appendChild(chip);
            });

            // Rows
            data.comparison_matrix.rows.forEach(row => {
                let html = `
                    <tr class="hover:bg-slate-800/50 transition-colors group">
                        <td class="px-6 py-4 font-bold text-white border-b border-slate-700">
                            ${row.name}
                            <details class="mt-2 text-xs font-normal text-slate-400">
                                <summary class="cursor-pointer hover:text-cyan-400">陷阱與口訣</summary>
                                <div class="pl-2 mt-1 border-l-2 border-yellow-500">
                                    <p class="mb-1"><span class="text-red-400">陷阱:</span> ${row.pitfall}</p>
                                    <p><span class="text-green-400">口訣:</span> ${row.rule_of_thumb}</p>
                                </div>
                            </details>
                        </td>
                `;
                
                data.comparison_matrix.dimensions.forEach(dim => {
                    html += `<td class="px-6 py-4 border-b border-slate-700">${row.values[dim]}</td>`;
                });
                
                html += `</tr>`;
                matrixBody.innerHTML += html;
            });
        }

        function highlightColumn(colIdx) {
            // Remove previous highlights
            document.querySelectorAll('td, th').forEach(el => el.classList.remove('bg-cyan-900/30', 'text-cyan-300'));
            
            // Add highlight
            const table = document.querySelector('#matrix table');
            // Header
            table.querySelector(`thead tr th:nth-child(${colIdx + 1})`).classList.add('text-cyan-300');
            // Body cells
            table.querySelectorAll(`tbody tr td:nth-child(${colIdx + 1})`).forEach(td => {
                td.classList.add('bg-cyan-900/30', 'text-cyan-300');
            });
        }

        function initDrill() {
            // Flashcards
            const fcContainer = document.getElementById('flashcards-grid');
            data.flashcards.forEach(fc => {
                const html = `
                    <div class="perspective h-64 w-full" onclick="this.querySelector('.flip-card-inner').classList.toggle('flipped')">
                        <div class="flip-card-inner bg-slate-800 rounded-xl shadow-lg border border-slate-700">
                            <div class="flip-card-front">
                                <h3 class="text-lg font-bold text-cyan-400">${fc.front}</h3>
                                <p class="text-xs text-slate-500 mt-4">(點擊翻面)</p>
                            </div>
                            <div class="flip-card-back">
                                <p class="text-sm text-slate-200">${fc.back}</p>
                            </div>
                        </div>
                    </div>
                `;
                fcContainer.innerHTML += html;
            });

            // Scenarios
            const scContainer = document.getElementById('scenario-container');
            data.scenario_checks.forEach((sc, idx) => {
                const html = `
                    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700" id="sc-${idx}">
                        <p class="text-slate-200 mb-4 font-medium">${sc.statement}</p>
                        <div class="flex gap-4" id="sc-btns-${idx}">
                            <button onclick="checkScenario(${idx}, 'O')" class="flex-1 py-2 rounded bg-slate-700 hover:bg-slate-600 text-white font-bold transition">O</button>
                            <button onclick="checkScenario(${idx}, 'X')" class="flex-1 py-2 rounded bg-slate-700 hover:bg-slate-600 text-white font-bold transition">X</button>
                        </div>
                        <div id="sc-res-${idx}" class="hidden mt-4 p-3 rounded bg-slate-900 border text-sm"></div>
                    </div>
                `;
                scContainer.innerHTML += html;
            });
        }

        function checkScenario(idx, userAns) {
            const sc = data.scenario_checks[idx];
            const isCorrect = userAns === sc.answer;
            const resDiv = document.getElementById(`sc-res-${idx}`);
            const btnDiv = document.getElementById(`sc-btns-${idx}`);

            btnDiv.classList.add('hidden'); // Hide buttons
            resDiv.classList.remove('hidden');
            
            if (isCorrect) {
                resDiv.classList.add('border-green-500', 'text-green-400');
                resDiv.innerHTML = `<strong>正確！</strong> ${sc.explanation}`;
            } else {
                resDiv.classList.add('border-red-500', 'text-red-400');
                resDiv.innerHTML = `<strong>答錯了。</strong>正確答案是 ${sc.answer}。<br>${sc.explanation}`;
            }
        }

        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', () => {
            initDashboard();
            initLab();
            initMatrix();
            initDrill();
            document.getElementById('raw-notes').textContent = data.original_notes_for_appendix;
        });

    </script>
</body>
</html>