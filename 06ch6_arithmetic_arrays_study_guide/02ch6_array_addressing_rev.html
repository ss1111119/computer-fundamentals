<!DOCTYPE html>
<html lang="zh-TW" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>02 陣列定址：邏輯與物理的對應 - 學習導論</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6', // Blue 500
                        secondary: '#f59e0b', // Amber 500
                        accent: '#ec4899', // Pink 500
                        darkBg: '#0f172a',
                        cardBg: '#1e293b',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(14px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .flat-mem-cell {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .flat-mem-cell.active {
            background-color: #3b82f6;
            color: white;
            transform: translateY(-8px) scale(1.1);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
            border-color: #60a5fa;
        }

        .matrix-cell {
            transition: all 0.2s ease;
        }

        .matrix-cell.active {
            background-color: #3b82f6/20;
            border-color: #3b82f6;
            color: white;
        }

        .flip-card {
            perspective: 1000px;
        }

        .flip-card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front,
        .flip-card-back {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .flip-card-back {
            transform: rotateY(180deg);
        }

        .detective-glass {
            background: radial-gradient(circle at center, transparent 30%, rgba(59, 130, 246, 0.1) 100%);
            border: 2px dashed #3b82f6;
        }
    </style>
</head>

<body class="p-4 md:p-8 lg:p-12">

    <!-- Header -->
    <header class="max-w-6xl mx-auto mb-16 relative">
        <div class="absolute -top-10 -left-10 w-48 h-48 bg-primary/10 rounded-full blur-3xl"></div>
        <div class="flex items-center gap-3 mb-6">
            <span
                class="px-4 py-1 text-[10px] font-black tracking-widest uppercase bg-primary/20 text-primary border border-primary/30 rounded-full">Section
                02</span>
            <span class="text-slate-600">|</span>
            <span class="text-slate-400 font-bold text-xs uppercase">Chapter 06 算術式表示法與陣列</span>
        </div>
        <h1 class="text-5xl md:text-8xl font-black text-white tracking-widest mb-8 italic italic italic">陣列定址 <span
                class="text-primary">/</span> Mapping</h1>
        <p class="text-xl text-slate-400 max-w-4xl leading-relaxed font-light">
            解決「邏輯結構」與「物理儲存」的不匹配。人類眼中的表格資料，最終都必須被「壓扁」放入只有一維線性位址的記憶體中。
        </p>
    </header>

    <main class="max-w-6xl mx-auto space-y-16">

        <!-- Reverse Engineering Lab -->
        <section class="glass-card p-12 rounded-[3.5rem] relative overflow-hidden">
            <div class="absolute -top-10 -right-10 w-64 h-64 bg-primary/5 rounded-full blur-3xl pointer-events-none">
            </div>
            <div class="flex flex-col md:flex-row justify-between items-start gap-8 mb-12">
                <div>
                    <h2 class="text-3xl font-black text-white mb-2 uppercase tracking-tighter italic">偵探式解題：逆向映射</h2>
                    <p class="text-slate-500 text-sm">從物理位址的「間距」反推元素的記憶體特徵。</p>
                </div>
                <div class="p-6 bg-slate-900/80 rounded-3xl border border-slate-800 detective-glass">
                    <div class="text-[10px] font-black text-primary uppercase mb-2">已知點 A (Know Points)</div>
                    <div class="flex gap-8 text-xs font-bold text-slate-300 mono">
                        <div>A[20] = <span class="text-white">120</span></div>
                        <div>A[100] = <span class="text-white">440</span></div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="space-y-6">
                    <div
                        class="p-8 bg-slate-950 rounded-3xl border border-slate-900 group hover:border-primary transition-all">
                        <h4 class="text-[10px] font-black text-slate-500 uppercase mb-4 tracking-widest">Step 1: 計算位址差
                        </h4>
                        <div class="text-2xl font-black text-white mono mb-2">440 - 120 = <span
                                class="text-primary">320</span></div>
                        <p class="text-[10px] text-slate-600">這一段記憶體總共跳過了 320 bytes。</p>
                    </div>
                    <div
                        class="p-8 bg-slate-950 rounded-3xl border border-slate-900 group hover:border-primary transition-all">
                        <h4 class="text-[10px] font-black text-slate-500 uppercase mb-4 tracking-widest">Step 2: 計算索引差
                        </h4>
                        <div class="text-2xl font-black text-white mono mb-2">100 - 20 = <span
                                class="text-primary">80</span></div>
                        <p class="text-[10px] text-slate-600">中間總共有 80 個元素。 (假設 LowerBound 已抵銷)</p>
                    </div>
                </div>

                <div
                    class="lg:col-span-2 p-10 bg-slate-950 rounded-[3rem] border border-slate-900 flex flex-col justify-center items-center text-center shadow-2xl relative">
                    <div class="absolute top-6 left-6 flex gap-2">
                        <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                        <div
                            class="text-[8px] font-black text-slate-700 tracking-[0.3em] uppercase underline decoration-primary">
                            Evidence Analysis</div>
                    </div>
                    <div class="mb-4">
                        <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.5em] mb-4">結論推理 (Result)
                        </h3>
                        <div class="text-6xl font-black text-primary mono mb-6">Size = 4</div>
                        <p class="text-xs text-slate-400 font-light max-w-sm leading-relaxed">
                            解：320 bytes / 80 elements = 4 bytes per element.<br>
                            再代入公式：120 = Base + (20-0) * 4 → <b>Base = 40</b>。
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mapping Visual Duel -->
        <section class="glass-card p-12 rounded-[3.5rem]">
            <div class="flex flex-col lg:flex-row justify-between items-end gap-8 mb-16">
                <div>
                    <h2 class="text-3xl font-black text-white mb-2 uppercase tracking-widest italic">物理歧路：映射對決</h2>
                    <p class="text-slate-500 text-sm">同樣的矩陣 A[3×4]，在不同編譯器邏輯下的「竹籤排列」。</p>
                </div>
                <div class="flex bg-slate-950 p-2 rounded-2xl border border-slate-800 shadow-xl">
                    <button id="btn-row" onclick="setMode('row')"
                        class="px-8 py-3 text-[10px] font-black rounded-xl transition-all bg-primary text-white shadow-lg">Row-major
                        (C)</button>
                    <button id="btn-col" onclick="setMode('col')"
                        class="px-8 py-3 text-[10px] font-black rounded-xl transition-all text-slate-500">Column-major
                        (Fortran)</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                <!-- Logical Matrix -->
                <div class="space-y-8">
                    <div
                        class="flex justify-between items-center text-[10px] font-black text-slate-600 uppercase tracking-widest">
                        <span>Logical 2D View</span>
                        <span id="coord-label">Matrix A [3 x 4]</span>
                    </div>
                    <div id="matrix-container" class="grid grid-cols-4 gap-3">
                        <!-- Injected -->
                    </div>
                </div>

                <!-- Physical Memory -->
                <div class="space-y-8">
                    <div
                        class="flex justify-between items-center text-[10px] font-black text-slate-600 uppercase tracking-widest">
                        <span>Physical Memory View</span>
                        <span id="formula-display" class="text-primary italic mono">Base + (i * n + j) * Size</span>
                    </div>
                    <div id="memory-container"
                        class="flex flex-wrap gap-2 p-6 bg-slate-950 rounded-[2.5rem] border border-slate-900 min-h-[14rem] items-center justify-center">
                        <!-- Injected -->
                    </div>
                    <div class="p-6 bg-primary/5 rounded-2xl border border-primary/20 text-center">
                        <p class="text-[10px] text-slate-400 leading-relaxed font-bold">
                            口訣：<span class="text-primary">列主乘總行 (n)</span>，<span class="text-secondary">行主乘總列
                                (m)</span>。
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Triangular & Space-Time -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-10">
            <!-- Triangular Matrix -->
            <div class="lg:col-span-2 glass-card p-12 rounded-[3.5rem] relative overflow-hidden group">
                <div
                    class="absolute -bottom-12 -left-12 w-48 h-48 bg-accent/5 rounded-full blur-3xl pointer-events-none group-hover:bg-accent/10 transition-all">
                </div>
                <h2 class="text-2xl font-black mb-8 text-white uppercase italic tracking-tight">壓縮矩陣：空間的極致追求</h2>
                <div class="flex flex-col md:flex-row gap-12 items-center">
                    <div id="tri-visual" class="grid grid-cols-5 gap-1 shrink-0">
                        <!-- Matrix with 0s -->
                    </div>
                    <div class="flex-1 space-y-6">
                        <p class="text-sm text-slate-400 leading-relaxed">
                            對於<b>上三角矩陣</b>，我們只存有資料的 <span class="mono text-white">n(n+1)/2</span> 個格子。
                        </p>
                        <div class="p-6 bg-slate-950 rounded-2xl border border-slate-800">
                            <div class="text-[10px] font-black text-slate-600 uppercase mb-2">壓縮公式 (Index in 1D)</div>
                            <div
                                class="text-xl font-bold italic text-white mono underline decoration-accent decoration-2 underline-offset-8">
                                i * (2*n - i + 1) / 2 + (j - i)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Space-Time Tradeoff -->
            <div class="glass-card p-12 rounded-[3.5rem] border-secondary/20 flex flex-col justify-between">
                <div>
                    <h2 class="text-2xl font-black mb-6 text-secondary uppercase italic tracking-tighter">時空權衡</h2>
                    <p class="text-xs text-slate-500 leading-relaxed font-light">
                        雖然我們拯救了記憶體量 (Space Saved)，但每次讀取資料都要執行複雜的乘法與除法公式 (CPU Cost Increased)。
                    </p>
                </div>
                <div class="space-y-4 mt-8">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-black text-slate-600">Storage Size</span>
                        <div class="w-24 h-2 bg-slate-800 rounded-full overflow-hidden">
                            <div class="w-1/3 h-full bg-green-500"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-black text-slate-600">Address Calc Cost</span>
                        <div class="w-24 h-2 bg-slate-800 rounded-full overflow-hidden">
                            <div class="w-full h-full bg-red-500"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Flashcards & Scenarios -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            <section class="glass-card p-10 rounded-[3rem]">
                <h2 class="text-2xl font-black mb-10 flex justify-between items-center text-white">
                    Recall Flashcards
                    <span id="card-index" class="text-[10px] font-bold text-slate-500 tracking-widest uppercase">1 /
                        5</span>
                </h2>
                <div class="flip-card h-56 cursor-pointer" id="flashcard">
                    <div class="flip-card-inner h-full w-full relative">
                        <div
                            class="flip-card-front absolute inset-0 bg-slate-900 rounded-[2.5rem] border border-slate-800 flex items-center justify-center p-10 text-center">
                            <h3 id="card-front" class="text-xl font-bold text-white tracking-tight leading-snug"></h3>
                        </div>
                        <div
                            class="flip-card-back absolute inset-0 bg-primary/20 rounded-[2.5rem] border border-primary/40 flex items-center justify-center p-10 text-center">
                            <p id="card-back" class="text-base font-bold text-slate-200 leading-relaxed"></p>
                        </div>
                    </div>
                </div>
                <div class="flex justify-center gap-8 mt-10">
                    <button onclick="prevCard()"
                        class="p-3 rounded-full hover:bg-slate-800 text-slate-500 transition-all active:scale-95"><svg
                            class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                            </path>
                        </svg></button>
                    <button onclick="nextCard()"
                        class="p-3 rounded-full hover:bg-slate-800 text-slate-500 transition-all active:scale-95"><svg
                            class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                            </path>
                        </svg></button>
                </div>
            </section>

            <!-- Scenario Checks -->
            <section class="glass-card p-10 rounded-[3rem]">
                <h2 class="text-2xl font-black mb-10 text-white uppercase italic tracking-tighter">真偽辨正 (Scenario Check)
                </h2>
                <div id="scenarios-list" class="space-y-6">
                    <!-- Injected -->
                </div>
            </section>
        </div>

        <!-- Feynman Rebuild -->
        <section
            class="glass-card p-12 rounded-[4rem] bg-gradient-to-tr from-cardBg via-slate-900 to-primary/10 border-none shadow-3xl">
            <h2
                class="text-3xl font-black mb-12 text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary uppercase tracking-tighter italic font-black">
                費曼學習法：記憶體的查房系統</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                <div class="space-y-12">
                    <div>
                        <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.4em] mb-6">解析語義核心</h4>
                        <p id="feynman-plain" class="text-4xl font-black text-white leading-[1.1]"></p>
                    </div>
                    <div class="p-10 bg-slate-950 rounded-[3rem] border border-slate-800 shadow-inner">
                        <div class="flex items-center gap-4 mb-4">
                            <span
                                class="px-3 py-1 bg-primary text-[8px] font-black text-white rounded-full uppercase tracking-widest">Analogy</span>
                        </div>
                        <p id="feynman-analogy" class="text-slate-400 italic leading-relaxed text-sm font-light"></p>
                    </div>
                </div>
                <div>
                    <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.4em] mb-8">攻心教案 (Teach Flow)
                    </h4>
                    <div id="feynman-steps" class="space-y-8">
                        <!-- Injected -->
                    </div>
                </div>
            </div>
            <div
                class="mt-20 pt-10 border-t border-slate-800/50 flex flex-col md:flex-row gap-8 items-center justify-center">
                <div id="trigger-tags" class="flex flex-wrap gap-2 justify-center"></div>
                <div class="hidden md:block w-px h-10 bg-slate-800"></div>
                <p id="feynman-one-minute"
                    class="text-xs font-bold text-primary max-w-lg text-center leading-relaxed tracking-wider"></p>
            </div>
        </section>

    </main>

    <footer
        class="max-w-6xl mx-auto mt-24 mb-16 text-center text-slate-700 text-[10px] font-black tracking-[0.5em] uppercase">
        <p>© Section 02 - Array Addressing | Part of Chapter 6 Series</p>
    </footer>

    <script>
        const data = {
            "chapter_positioning": {
                "one_sentence": "本節探討如何將多維的邏輯座標映射到一維的物理位址，建立「空間線性化」的核心數學模型。",
                "prerequisites": ["第六章 算術式表示法與陣列導論", "第三章 記憶體定址基礎"],
                "downstream_links": ["第七章 資料結構實作", "編譯器底層位址運算"]
            },
            "keywords": [
                {
                    "term": "映射 (Mapping)",
                    "why_important": "將人類的高階視圖轉換為機器低階指令的橋樑。",
                    "common_exam_angle": "理解邏輯座標到物理位址的變換過程。"
                },
                {
                    "term": "偏移量 (Offset)",
                    "why_important": "決定元素在記憶體中具體「跳過」了多少空間。",
                    "common_exam_angle": "給定兩點位址反推元素大小 (Size) 或起始位址 (Base)。"
                },
                {
                    "term": "以列為主 (Row-major)",
                    "why_important": "C/C++ 的主流存儲策略，填滿一列後再填下一列。",
                    "common_exam_angle": "公式計算與跨過「完整列」的邏輯判斷。"
                },
                {
                    "term": "以行為主 (Column-major)",
                    "why_important": "Fortran 等語言的存儲策略，填滿一行後再填下一行。",
                    "common_exam_angle": "公式計算與跨過「完整行」的邏輯判斷。"
                },
                {
                    "term": "空間換時間 (Time-Space Tradeoff)",
                    "why_important": "在壓縮矩陣中節省了空間，但增加了位址計算的複雜度。",
                    "common_exam_angle": "特殊矩陣 (三角矩陣) 的一維索引公式。"
                }
            ],
            "comparison_matrix": {
                "title": "二維陣列儲存策略對抗",
                "dimensions": ["核心看法人話版", "常見採用語言", "i, j 索引關係", "物理排列規律"],
                "rows": [
                    {
                        "name": "以列為主 (Row-major)",
                        "values": {
                            "核心看法人話版": "「橫向掃描」：第一排搬完再搬第二排。",
                            "常見採用語言": "C/C++、Pascal、Java",
                            "i, j 索引關係": "i 決定跨過多少個 n (行數)",
                            "物理排列規律": "連續存列 (Row)"
                        }
                    },
                    {
                        "name": "以行為主 (Column-major)",
                        "values": {
                            "核心看法人話版": "「縱向掃描」：第一支柱子搬完再搬第二支。",
                            "常見採用語言": "Fortran、R、MATLAB",
                            "i, j 索引關係": "j 決定跨過多少個 m (列數)",
                            "物理排列規律": "連續存行 (Column)"
                        }
                    }
                ]
            },
            "feynman_explanation": {
                "one_sentence_plain": "把複雜的二維表格、三維盒子壓扁成「一維糖葫蘆」，並算出每一顆糖在竹籤上的精確長度位置。",
                "analogy": "陣列定址就是「飯店查房」：飯店分 10 層 (列)，每層 5 間房 (行)。Row-major 是 101, 102... 照排；Column-major 則是 101, 201, 301... 照排。地址公式就是櫃檯查號系統。",
                "forbidden_terms_used": ["空間線性化", "歧路", "逆向工程"]
            },
            "feynman_rebuild": {
                "teach_flow": [
                    "首先，理解「竹籤」本質：記憶體只是一根無限長的竹籤 (一維)，不管資料多立體，都要乖乖排隊。",
                    "接著，介紹兩大流派：Row-major (橫著串) 是目前的主流；Column-major (直著串) 是科學界的傳統。選錯流派，地址這輩子都算不出來。",
                    "最後，解鎖偵探神技：如果給你頭跟尾的地址，你就能算出每一格多大。不需要死背公式，看元素間的「間距」才是王道。"
                ],
                "one_minute_version": "陣列定址是計算機解決空間線性化的核心模型。透過映射函數，我們將多維邏輯座標轉換為一維物理位址。核心在於區分 Row-major (列主) 與 Column-major (行主) 的排列歧路，並靈活運用偏移量公式處理 LowerBound。這不僅支持了 O(1) 的隨機存取，更透過特殊矩陣壓縮展現了時空權衡 (Time-Space Tradeoff) 的極致效率思維。",
                "exam_trigger_phrases": [
                    "確認排列方式 (Row/Col)",
                    "列主乘總行 (n)",
                    "行主乘總列 (m)",
                    "Base + Offset",
                    "解題首重間距 (Size)"
                ]
            },
            "flashcards": [
                {
                    "front": "二維陣列 A[m, n] 若採 Row-major，A[i, j] 的定址公式？(索引 0 開始)",
                    "back": "Base + (i * n + j) * Size。"
                },
                {
                    "front": "二維陣列 A[m, n] 若採 Column-major，A[i, j] 的定址公式？(索引 0 開始)",
                    "back": "Base + (j * m + i) * Size。"
                },
                {
                    "front": "若 A[20]=120, A[100]=440，則元素 Size 為？",
                    "back": "(440 - 120) / (100 - 20) = 4。"
                },
                {
                    "front": "下三角矩陣 (Lower Triangular) A[n, n] 壓縮後索引公式？",
                    "back": "Loc(A[i,j]) = i*(i+1)/2 + j (假設索引 0 開始且只存非零)。"
                },
                {
                    "front": "什麼是 Time-Space Tradeoff 在陣列中的體現？",
                    "back": "壓縮矩陣節省了存儲空間，但增加了計算索引的 CPU 固定開銷。"
                }
            ],
            "scenario_checks": [
                {
                    "statement": "在 Row-major 中，計算 A[i, j] 位址時需乘以總列數 (m)。",
                    "answer": "X",
                    "explanation": "錯誤。Row-major 是跨過 i 個「完整列」，每列有 n (總行數) 個元素，因此應乘上 n。"
                },
                {
                    "statement": "如果題目未指定排列方式，通常預設為以列為主 (Row-major)。",
                    "answer": "O",
                    "explanation": "正確。因為現代多數編譯器 (C 家族) 採用 Row-major。"
                }
            ]
        };

        let currentMode = 'row';
        const rows = 3;
        const cols = 4;

        function renderDuel() {
            const matrix = document.getElementById('matrix-container');
            const memory = document.getElementById('memory-container');
            matrix.innerHTML = '';
            memory.innerHTML = '';

            const cells = [];
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    cells.push({ r, c });
                }
            }

            // Matrix Grid
            cells.forEach(cell => {
                const div = document.createElement('div');
                div.className = "h-14 bg-slate-900 border border-slate-800 rounded-xl flex items-center justify-center text-[10px] font-black text-slate-500 matrix-cell";
                div.innerText = `A[${cell.r}][${cell.c}]`;
                div.id = `m-${cell.r}-${cell.c}`;
                matrix.appendChild(div);
            });

            // Flatten logic
            const physicalOrder = currentMode === 'row'
                ? [...cells]
                : [...cells].sort((a, b) => a.c - b.c || a.r - b.r);

            physicalOrder.forEach((cell, idx) => {
                const div = document.createElement('div');
                div.className = "w-14 h-14 bg-slate-900 border-2 border-slate-800 rounded-xl flex flex-col items-center justify-center flat-mem-cell cursor-pointer p-1";
                div.innerHTML = `
                    <span class="text-[8px] font-black text-slate-600">${100 + idx * 4}</span>
                    <span class="text-[9px] font-black text-slate-400 mt-1">${cell.r},${cell.c}</span>
                `;
                div.onmouseover = () => {
                    div.classList.add('active');
                    document.getElementById(`m-${cell.r}-${cell.c}`).classList.add('active', 'bg-primary/20', 'text-white');
                };
                div.onmouseout = () => {
                    div.classList.remove('active');
                    document.getElementById(`m-${cell.r}-${cell.c}`).classList.remove('active', 'bg-primary/20', 'text-white');
                };
                memory.appendChild(div);
            });

            document.getElementById('formula-display').innerText = currentMode === 'row'
                ? "Base + (i * 4 + j) * 4"
                : "Base + (j * 3 + i) * 4";
        }

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-row').className = mode === 'row' ? "px-8 py-3 text-[10px] font-black rounded-xl transition-all bg-primary text-white shadow-lg" : "px-8 py-3 text-[10px] font-black rounded-xl transition-all text-slate-500";
            document.getElementById('btn-col').className = mode === 'col' ? "px-8 py-3 text-[10px] font-black rounded-xl transition-all bg-primary text-white shadow-lg" : "px-8 py-3 text-[10px] font-black rounded-xl transition-all text-slate-500";
            renderDuel();
        }

        function renderTriangular() {
            const tri = document.getElementById('tri-visual');
            tri.innerHTML = '';
            for (let i = 0; i < 5; i++) {
                for (let j = 0; j < 5; j++) {
                    const cell = document.createElement('div');
                    const isData = j >= i;
                    cell.className = `w-8 h-8 flex items-center justify-center rounded-lg text-[10px] font-black ${isData ? 'bg-accent/20 border border-accent/40 text-accent' : 'bg-slate-900 text-slate-800 border border-slate-950'}`;
                    cell.innerText = isData ? 'V' : '0';
                    tri.appendChild(cell);
                }
            }
        }

        // FLASHCARDS
        let curCard = 0;
        const flashcard = document.getElementById('flashcard');
        function updateCard() {
            flashcard.classList.remove('flipped');
            setTimeout(() => {
                document.getElementById('card-front').innerText = data.flashcards[curCard].front;
                document.getElementById('card-back').innerText = data.flashcards[curCard].back;
                document.getElementById('card-index').innerText = `${curCard + 1} / ${data.flashcards.length}`;
            }, 300);
        }
        flashcard.onclick = () => flashcard.classList.toggle('flipped');
        function nextCard() { curCard = (curCard + 1) % data.flashcards.length; updateCard(); }
        function prevCard() { curCard = (curCard - 1 + data.flashcards.length) % data.flashcards.length; updateCard(); }

        function renderScenarios() {
            const list = document.getElementById('scenarios-list');
            data.scenario_checks.forEach((sc, idx) => {
                const div = document.createElement('div');
                div.className = "p-8 rounded-[2rem] bg-slate-950 border border-slate-900 shadow-xl transition-all hover:border-slate-700 group";
                div.innerHTML = `
                    <p class="text-[11px] font-bold text-slate-300 mb-8 leading-relaxed tracking-wide">${sc.statement}</p>
                    <div class="flex gap-4">
                        <button onclick="checkScenario(${idx}, 'O')" class="flex-1 py-3 text-[10px] font-black rounded-2xl border border-slate-800 hover:border-primary transition-all">是 (O)</button>
                        <button onclick="checkScenario(${idx}, 'X')" class="flex-1 py-3 text-[10px] font-black rounded-2xl border border-slate-800 hover:border-primary transition-all">否 (X)</button>
                    </div>
                    <div id="sc-res-${idx}" class="mt-6 hidden p-6 rounded-2xl text-[10px] italic leading-relaxed"></div>
                `;
                list.appendChild(div);
            });
        }

        function checkScenario(idx, choice) {
            const sc = data.scenario_checks[idx];
            const res = document.getElementById(`sc-res-${idx}`);
            const correct = choice === sc.answer;
            res.classList.remove('hidden', 'bg-primary/20', 'text-primary', 'bg-red-500/20', 'text-red-500');
            res.classList.add(correct ? 'bg-primary/10' : 'bg-red-500/10');
            res.classList.add(correct ? 'text-primary' : 'text-red-500');
            res.innerHTML = `<b>${correct ? "Bingo!" : "Wait..."}</b><br>${sc.explanation}`;
        }

        function renderFeynman() {
            document.getElementById('feynman-plain').innerText = data.feynman_explanation.one_sentence_plain;
            document.getElementById('feynman-analogy').innerText = data.feynman_explanation.analogy;
            document.getElementById('feynman-one-minute').innerText = data.feynman_rebuild.one_minute_version;
            const steps = document.getElementById('feynman-steps');
            data.feynman_rebuild.teach_flow.forEach((s, idx) => {
                steps.innerHTML += `
                    <div class="flex gap-6 items-start group">
                        <div class="w-8 h-8 rounded-xl bg-slate-800 border border-slate-700 flex items-center justify-center shrink-0 text-[10px] font-black text-primary group-hover:bg-primary group-hover:text-white transition-all">${idx + 1}</div>
                        <p class="text-sm text-slate-400 font-bold leading-relaxed pt-1">${s}</p>
                    </div>
                `;
            });
            const triggers = document.getElementById('trigger-tags');
            data.feynman_rebuild.exam_trigger_phrases.forEach(p => {
                triggers.innerHTML += `<span class="px-3 py-1 bg-slate-900 border border-slate-800 text-[10px] font-black text-slate-600 rounded-lg hover:text-white cursor-default"># ${p}</span>`;
            });
        }

        // BOOT
        renderDuel();
        renderTriangular();
        updateCard();
        renderScenarios();
        renderFeynman();

    </script>
</body>

</html>