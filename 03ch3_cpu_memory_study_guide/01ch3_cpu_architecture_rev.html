<!DOCTYPE html>
<html lang="zh-TW" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch3 CPU æ¶æ§‹èˆ‡æŒ‡ä»¤é€±æœŸ - äº’å‹•è¤‡ç¿’æŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#f43f5e', // Rose-500
                        secondary: '#3b82f6', // Blue-500
                        dark: '#0f172a', // Slate-900
                        surface: '#1e293b', // Slate-800
                    }
                }
            }
        }
    </script>
    <style>
        .flip-card {
            background-color: transparent;
            perspective: 1000px;
            cursor: pointer;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front,
        .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .flip-card-back {
            transform: rotateY(180deg);
        }

        .raw-notes::-webkit-scrollbar {
            width: 8px;
        }

        .raw-notes::-webkit-scrollbar-track {
            background: #1e293b;
        }

        .raw-notes::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        /* Cycle Animation */
        .cycle-step {
            transition: all 0.5s ease;
            opacity: 0.4;
            transform: scale(0.95);
        }

        .cycle-step.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }

        .data-dot {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #f43f5e;
            border-radius: 50%;
            transition: all 1s ease-in-out;
            opacity: 0;
        }
    </style>
</head>

<body class="bg-dark text-slate-200 font-sans antialiased min-h-screen">

    <div class="max-w-6xl mx-auto p-4 md:p-8 space-y-12">

        <!-- Header -->
        <header class="space-y-4 text-center border-b border-slate-700 pb-8 animate-fade-in-down">
            <div
                class="inline-block px-3 py-1 text-xs font-semibold tracking-wider text-primary uppercase bg-primary/10 rounded-full">
                Chapter 3: CPU Architecture (Part 1)
            </div>
            <h1
                class="text-3xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">
                CPU æ¶æ§‹èˆ‡æŒ‡ä»¤é€±æœŸ
            </h1>
            <p class="text-slate-400 text-lg max-w-2xl mx-auto">
                é›»è…¦ç¡¬é«”é‹ä½œçš„ç”Ÿç†æ©Ÿåˆ¶ï¼šå¿ƒè‡Ÿèˆ¬çš„å¾‹å‹•ï¼Œé©…å‹•è‘— Fetch, Decode, Execute çš„æ°¸æ†å¾ªç’°ã€‚
            </p>
            <div class="flex justify-center gap-4 text-sm text-slate-500 pt-2">
                <div class="flex items-center gap-1">
                    <span class="text-xs border border-slate-600 rounded px-1">å‰ç½®</span>
                    <span>æ•¸ä½é‚è¼¯</span>
                </div>
                <span>â†’</span>
                <div class="flex items-center gap-1">
                    <span class="text-xs border border-slate-600 rounded px-1">å¾ŒçºŒ</span>
                    <span>ç®¡ç·šåŒ– (Pipelining)</span>
                </div>
            </div>
        </header>

        <!-- Module A: Strategic Dashboard -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-surface rounded-xl p-6 shadow-lg border border-slate-700">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                        </path>
                    </svg>
                    é—œéµå­—é›·é”
                </h2>
                <div class="flex flex-wrap gap-2" id="keywords-container"></div>
                <div id="keyword-detail"
                    class="mt-4 p-3 bg-dark/50 rounded-lg text-sm text-slate-300 min-h-[80px] hidden"></div>
            </div>
            <div class="bg-surface rounded-xl p-6 shadow-lg border border-slate-700">
                <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                    </svg>
                    å‡ºé¡Œä½”æ¯” (é ä¼°)
                </h2>
                <div class="space-y-3" id="weighting-container"></div>
            </div>
        </section>

        <!-- Module D: Comparison Matrix -->
        <section class="bg-surface rounded-xl shadow-lg border border-slate-700 overflow-hidden">
            <div class="p-6 border-b border-slate-700">
                <h2 class="text-2xl font-bold text-white mb-2">æŒ‡ä»¤æ ¼å¼æ¬Šè¡¡ï¼š0 èˆ‡ 3 çš„å°æ±º</h2>
                <p class="text-slate-400 text-sm">Hardware Complexity vs Code Elasticity</p>
                <div class="flex flex-wrap gap-2 mt-4" id="matrix-dimensions"></div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="text-slate-400 text-sm bg-dark/50 border-b border-slate-700">
                            <th class="p-4 w-1/4">æ¯”è¼ƒå°è±¡</th>
                            <th class="p-4 dimension-col" data-idx="0">ç¡¬é«”éœ€æ±‚</th>
                            <th class="p-4 dimension-col" data-idx="1">ç¨‹å¼é•·åº¦</th>
                            <th class="p-4 dimension-col" data-idx="2">é‹ä½œæ©Ÿåˆ¶</th>
                            <th class="p-4 dimension-col" data-idx="3">é©ç”¨æƒ…å¢ƒ</th>
                        </tr>
                    </thead>
                    <tbody id="matrix-body" class="text-slate-300"></tbody>
                </table>
            </div>
        </section>

        <!-- Module B: Core Concept Lab - Instruction Cycle Simulator -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div
                class="lg:col-span-2 bg-gradient-to-br from-surface to-dark rounded-xl p-1 shadow-lg border border-blue-500/30">
                <div class="h-full bg-dark/80 rounded-lg p-6 backdrop-blur-sm relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <svg class="w-32 h-32 text-secondary" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z" />
                        </svg>
                    </div>

                    <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2 relative z-10">
                        <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Concept Lab: æ©Ÿå™¨é€±æœŸçš„å¾‹å‹•
                    </h2>

                    <div class="flex flex-col gap-8 relative z-10 items-center">
                        <!-- Play Controls -->
                        <div class="flex gap-4">
                            <button
                                class="px-4 py-2 bg-secondary hover:bg-blue-600 rounded font-bold shadow text-white transition-all transform hover:scale-105"
                                onclick="runCycle()">
                                â–¶ åŸ·è¡Œå–®æ¬¡é€±æœŸ (Single Step)
                            </button>
                            <div class="flex items-center gap-2 px-3 bg-surface rounded border border-slate-600">
                                <span class="text-xs text-slate-400">PC:</span>
                                <span class="font-mono text-primary font-bold" id="pc-val">00</span>
                            </div>
                            <div class="flex items-center gap-2 px-3 bg-surface rounded border border-slate-600">
                                <span class="text-xs text-slate-400">IR:</span>
                                <span class="font-mono text-secondary font-bold" id="ir-val">EMPTY</span>
                            </div>
                        </div>

                        <!-- Cycle Visualization -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full text-center relative">
                            <!-- Steps -->
                            <div class="cycle-step p-4 rounded-lg border-2 border-slate-700 bg-slate-800"
                                id="step-fetch">
                                <div class="text-xl mb-2">ğŸ¤² Fetch</div>
                                <div class="text-xs text-slate-400">PC -> MAR -> MBR -> IR</div>
                            </div>
                            <div class="cycle-step p-4 rounded-lg border-2 border-slate-700 bg-slate-800"
                                id="step-decode">
                                <div class="text-xl mb-2">ğŸ§  Decode</div>
                                <div class="text-xs text-slate-400">CU: "Load A to ACC"</div>
                            </div>
                            <div class="cycle-step p-4 rounded-lg border-2 border-slate-700 bg-slate-800"
                                id="step-execute">
                                <div class="text-xl mb-2">âš™ï¸ Execute</div>
                                <div class="text-xs text-slate-400">ALU / Data Bus Active</div>
                            </div>
                            <div class="cycle-step p-4 rounded-lg border-2 border-slate-700 bg-slate-800"
                                id="step-store">
                                <div class="text-xl mb-2">ğŸ’¾ Store</div>
                                <div class="text-xs text-slate-400">Result -> ACC/Ram</div>
                            </div>

                            <!-- Moving Dot -->
                            <div class="data-dot" id="data-dot"></div>
                        </div>

                        <div class="text-center text-sm text-slate-300 min-h-[40px]" id="cycle-msg">æº–å‚™å°±ç·’ï¼Œè«‹é»æ“ŠåŸ·è¡Œã€‚</div>
                    </div>
                </div>
            </div>

            <!-- Mistakes Panel -->
            <div class="bg-surface rounded-xl p-6 shadow-lg border border-slate-700 flex flex-col">
                <h3 class="text-lg font-bold text-white mb-4 text-red-400">âš ï¸ å¸¸è¦‹èª¤å€</h3>
                <div class="space-y-4 overflow-y-auto pr-2 custom-scrollbar flex-1" id="mistakes-container"></div>
            </div>
        </section>

        <!-- Module C: Exam Drill -->
        <section class="space-y-8">
            <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                å¯¦æˆ°æ¼”ç·´å ´
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="flashcards-container"></div>
            <div class="bg-surface rounded-xl p-6 border border-slate-700">
                <h3 class="text-lg font-semibold text-slate-400 mb-6">è§€å¿µæ˜¯éé¡Œ</h3>
                <div class="space-y-6" id="scenarios-container"></div>
            </div>
        </section>

        <!-- Module E: Appendix -->
        <section class="border-t border-slate-700 pt-8">
            <button id="accordion-btn"
                class="w-full flex justify-between items-center p-4 bg-slate-800 hover:bg-slate-700 rounded-lg transition-colors">
                <span class="font-bold text-slate-300">é™„éŒ„ï¼šæˆ‘çš„åŸå§‹ç­†è¨˜</span>
                <svg id="accordion-icon" class="w-5 h-5 text-slate-400 transform transition-transform" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            <div id="accordion-content" class="hidden mt-2 p-4 bg-black/30 rounded-lg border border-slate-800">
                <pre class="raw-notes text-sm text-slate-400 whitespace-pre-wrap font-mono h-64 overflow-y-auto"
                    id="raw-notes-content"></pre>
            </div>
        </section>

        <footer class="text-center text-slate-600 py-8 text-sm">
            Based on User Notes â€¢ Generated by Agentic AI â€¢ 2026
        </footer>
    </div>

    <script>
        const data = {
            "keywords": [
                { "term": "Von Neumann Architecture", "why_important": "æŒ‡ä»¤èˆ‡è³‡æ–™å…±å­˜æ–¼è¨˜æ†¶é«” (Stored Program)ã€‚ç¨‹åºåŒ–é‹ä½œã€‚", "common_exam_angle": "å€åˆ† Von Neumann èˆ‡ Harvard æ¶æ§‹" },
                { "term": "Instruction Cycle", "why_important": "é›»è…¦é‹ä½œçš„åŸºæœ¬å¾‹å‹• (Fetch-Decode-Execute)ã€‚", "common_exam_angle": "æ’åºå„æ­¥é©Ÿæˆ–å• PC/IR åœ¨å“ªæ­¥å‹•ä½œ" },
                { "term": "PC (Program Counter)", "why_important": "æœ€é‡è¦çš„æŒ‡æ¨™ï¼Œæ°¸é æŒ‡å‘ã€Œä¸‹ä¸€æ¢ã€æŒ‡ä»¤ã€‚", "common_exam_angle": "PC ä½•æ™‚å¢åŠ ï¼ŸæŠ“å®ŒæŒ‡ä»¤å¾Œã€‚" },
                { "term": "Opcode (é‹ç®—ç¢¼)", "why_important": "æŒ‡ä»¤ä¸­å‘Šè¨´ CPUã€Œåšä»€éº¼ã€çš„éƒ¨åˆ† (å¦‚ ADD, MOV)ã€‚", "common_exam_angle": "æŒ‡ä»¤è§£ç¢¼éšæ®µå°±æ˜¯åœ¨åˆ†æ Opcode" }
            ],
            "weighting": {
                "items": [
                    { "topic": "Registers Function (PC/IR/MAR)", "weight": 90, "reason": "å¿…è€ƒé¡Œã€‚éœ€åˆ†æ¸…æ¥š PC èˆ‡ IR çš„å·®ç•°ã€‚" },
                    { "topic": "Instruction Cycle Steps", "weight": 85, "reason": "æµç¨‹é¡Œæ ¸å¿ƒã€‚" },
                    { "topic": "Instruction Formats (0/3 addr)", "weight": 70, "reason": "é€²éšæ¯”è¼ƒé¡Œï¼Œè€ƒ Trade-off æ¦‚å¿µã€‚" }
                ]
            },
            "comparison_matrix": {
                "dimensions": ["ç¡¬é«”éœ€æ±‚", "ç¨‹å¼é•·åº¦", "é‹ä½œæ©Ÿåˆ¶", "é©ç”¨æƒ…å¢ƒ"],
                "rows": [
                    {
                        "name": "é›¶ä½å€æŒ‡ä»¤ (Zero Address)",
                        "values": {
                            "ç¡¬é«”éœ€æ±‚": "ç°¡å–® (ç„¡å¤ªå¤šæš«å­˜å™¨)",
                            "ç¨‹å¼é•·åº¦": "æœ€é•· (éœ€å¤šè¡Œ PUSH/POP)",
                            "é‹ä½œæ©Ÿåˆ¶": "ä¾è³´å †ç–Š (Stack) é ‚ç«¯é‹ç®—",
                            "é©ç”¨æƒ…å¢ƒ": "ç°¡å–®è¨ˆç®—æ©Ÿã€Stack Machine"
                        },
                        "pitfall": "ä»¥ç‚ºæ²’æœ‰é‹ç®—å…ƒå°±ä¸èƒ½é‹ç®—ã€‚å…¶å¯¦æ˜¯éš±å«åœ¨ Stack Topã€‚",
                        "rule_of_thumb": "0 ä½å€ = ç–Šç–Šæ¨‚ (Stack)ã€‚"
                    },
                    {
                        "name": "ä¸‰ä½å€æŒ‡ä»¤ (Three Address)",
                        "values": {
                            "ç¡¬é«”éœ€æ±‚": "è¤‡é›œ (éœ€å¤šå€‹æš«å­˜å™¨åŸ )",
                            "ç¨‹å¼é•·åº¦": "æœ€çŸ­ (ä¸€è¡Œåšå®Œ A=B+C)",
                            "é‹ä½œæ©Ÿåˆ¶": "æ˜ç¢ºæŒ‡å®š ä¾†æº1, ä¾†æº2, ç›®çš„",
                            "é©ç”¨æƒ…å¢ƒ": "RISC æ¶æ§‹ã€é«˜æ•ˆèƒ½ CPU"
                        },
                        "pitfall": "æŒ‡ä»¤é•·åº¦éé•·ï¼Œå°è‡´è¨˜æ†¶é«”ä½”ç”¨è®Šå¤§ã€‚",
                        "rule_of_thumb": "3 ä½å€ = è±ªè¯å…¨é… (æº1, æº2, ç›®çš„)ã€‚"
                    }
                ]
            },
            "core_concept_lab": {
                "common_mistakes": [
                    { "mistake": "PC æŒ‡å‘ç¾åœ¨çš„æŒ‡ä»¤", "why_wrong": "PC æ°¸é æŒ‡å‘ã€Œæœªä¾† (Next)ã€ã€‚IR æ‰å­˜ã€Œç¾åœ¨ã€ã€‚", "how_to_fix": "PC = Next Step." },
                    { "mistake": "åœ¨ Execute éšæ®µæ‰å»æŠ“è³‡æ–™", "why_wrong": "è³‡æ–™å¯èƒ½åœ¨ Fetch éšæ®µå¾Œã€Execute å‰ (Operand Fetch) å°±éœ€è¦æº–å‚™å¥½ã€‚", "how_to_fix": "Fetch æ˜¯æŠ“æŒ‡ä»¤ï¼ŒExecute æ˜¯åšå‹•ä½œã€‚" },
                    { "mistake": "ALU è² è²¬è§£ç¢¼", "why_wrong": "CU (Control Unit) æ‰æ˜¯å¤§è…¦è² è²¬è§£ç¢¼ï¼ŒALU æ˜¯å››è‚¢è² è²¬åšè‹¦å·¥ã€‚", "how_to_fix": "CU = è€é—†, ALU = å‹å·¥ã€‚" }
                ]
            },
            "flashcards": [
                { "front": "Fetch (æ“·å–)", "back": "æŒ‡ä»¤é€±æœŸçš„ç¬¬ä¸€æ­¥ã€‚å°‡æŒ‡ä»¤å¾è¨˜æ†¶é«”è®€å…¥ IRï¼Œä¸¦æ›´æ–° PCã€‚" },
                { "front": "Decode (è§£ç¢¼)", "back": "CU åˆ†æ IR ä¸­çš„ Opcodeï¼Œæ±ºå®šè¦åŸ·è¡Œä»€éº¼å‹•ä½œã€‚" },
                { "front": "MAR (Memory Address Register)", "back": "å­˜æ”¾ã€Œæ¬²å­˜å–ã€è¨˜æ†¶é«”ä½å€çš„æš«å­˜å™¨ã€‚CPU çš„å°å¤–çª—å£ã€‚" },
                { "front": "Stored Program Concept", "back": "ç¨‹å¼èˆ‡è³‡æ–™éƒ½ä»¥äºŒé€²ä½å½¢å¼ï¼Œå­˜æ”¾åœ¨åŒä¸€å€‹å¯å®šå€çš„è¨˜æ†¶é«”ä¸­ã€‚" },
                { "front": "Machine Cycle", "back": "é›»è…¦åŸ·è¡Œä¸€å€‹æŒ‡ä»¤æ‰€éœ€çš„å®Œæ•´æ™‚é–“ã€‚å« Fetch, Decode, Executeã€‚" }
            ],
            "scenario_checks": [
                {
                    "statement": "å› ç‚º CPU é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ä¸€æ¬¡åŒæ™‚åŸ·è¡Œ Fetch å’Œ Execute åŒä¸€å€‹æŒ‡ä»¤ã€‚",
                    "answer": "X",
                    "explanation": "éŒ¯ã€‚æ¨™æº–é¦®ç´æ›¼æ¶æ§‹æ˜¯åºåˆ—åŸ·è¡Œçš„ã€‚Fetch å®Œæ‰èƒ½ Decodeã€‚(é™¤éç”¨ Pipeliningï¼Œä½†é‚£æ˜¯é€²éšæŠ€è¡“)ã€‚"
                },
                {
                    "statement": "ç¨‹å¼è¨ˆæ•¸å™¨ (PC) çš„å€¼ï¼Œåœ¨ Fetch éšæ®µå®Œæˆå¾Œæœƒè‡ªå‹•å¢åŠ ã€‚",
                    "answer": "O",
                    "explanation": "å°ã€‚Fetch å®Œå¾Œ PC å¿…é ˆæŒ‡å‘ä¸‹ä¸€æ¢æŒ‡ä»¤ï¼Œä»¥ä¾¿ä¸‹å€‹é€±æœŸä½¿ç”¨ã€‚"
                },
                {
                    "statement": "æŒ‡ä»¤æš«å­˜å™¨ (IR) å­˜æ”¾çš„æ˜¯ä¸‹ä¸€æ¢è¦åŸ·è¡Œçš„æŒ‡ä»¤ä½å€ã€‚",
                    "answer": "X",
                    "explanation": "éŒ¯ã€‚IR å­˜æ”¾çš„æ˜¯ã€Œæ­£åœ¨åŸ·è¡Œã€çš„æŒ‡ä»¤ã€Œå…§å®¹ã€(Opcode)ï¼Œä¸æ˜¯ä½å€ã€‚ä½å€åœ¨ PCã€‚"
                }
            ],
            "original_notes_for_appendix": `åœ¨ã€Œç¬¬ä¸‰ç«  CPU èˆ‡è¨˜æ†¶é«”æ¦‚è«–ã€çš„å®è§€æ¶æ§‹ä¸‹ï¼Œä¾†æºè³‡æ–™å°‡**ã€ŒCPU æ¶æ§‹èˆ‡æŒ‡ä»¤é€±æœŸã€è¦–ç‚ºé›»è…¦ç¡¬é«”é‹ä½œçš„ç”Ÿç†æ©Ÿåˆ¶**ã€‚
å¦‚æœèªªç¬¬äºŒç« çš„é‚è¼¯é–˜æ˜¯é›»è…¦çš„ã€Œç´°èƒã€ï¼Œé‚£éº¼é€™ä¸€éƒ¨åˆ†å°±æ˜¯åœ¨è§£é‡‹é›»è…¦çš„ã€Œå¿ƒè‡Ÿï¼ˆCPUï¼‰ã€å¦‚ä½•é€éè¦å¾‹çš„è·³å‹•ï¼ˆæŒ‡ä»¤é€±æœŸï¼‰ä¾†é©…å‹•æ•´å€‹ç³»çµ±ã€‚ä¾†æºè³‡æ–™å°æ­¤æŠ±æŒè‘—é«˜åº¦**ç¨‹åºåŒ–ï¼ˆProceduralï¼‰èˆ‡çµæ§‹åŒ–ï¼ˆStructuralï¼‰**çš„çœ‹æ³•ã€‚
æ ¹æ“šä¾†æºè³‡æ–™ï¼Œæˆ‘å€‘å¯ä»¥å¾ä»¥ä¸‹å››å€‹æ ¸å¿ƒè§€é»ä¾†æ·±å…¥æ¢è¨ï¼š
1. æ¶æ§‹è§€é»ï¼šé¦®Â·ç´æ›¼æ¨¡å‹çš„å¯¦é«”åŒ–
ä¾†æºè³‡æ–™å°‡ CPU å®šç¾©ç‚ºé›»è…¦çš„**ã€Œä¸­æ¨ç¥ç¶“ã€ï¼Œå…¶è¨­è¨ˆå®Œå…¨éµå¾ªé¦®Â·ç´æ›¼ (Von Neumann)** æ¶æ§‹ã€‚
â€¢ åŠŸèƒ½äºŒåˆ†æ³•ï¼šæ•™ææ˜ç¢ºå°‡ CPU åŠƒåˆ†ç‚ºè² è²¬ã€Œç™¼è™Ÿæ–½ä»¤ã€çš„æ§åˆ¶å–®å…ƒ (CU) èˆ‡è² è²¬ã€Œå¯¦éš›å‹å‹•ã€çš„ç®—è¡“é‚è¼¯å–®å…ƒ (ALU)ã€‚
â€¢ é‹ä½œå“²å­¸ï¼šé€™ç¨®æ¶æ§‹çš„æ ¸å¿ƒè§€é»æ˜¯**ã€Œå„²å­˜ç¨‹å¼ (Stored Program)ã€**æ¦‚å¿µï¼Œå³æŒ‡ä»¤èˆ‡è³‡æ–™éƒ½å­˜æ”¾åœ¨åŒä¸€å€‹è¨˜æ†¶é«”ä¸­ï¼ŒCPU å¿…é ˆä¾ç…§é †åºå»è®€å–ä¸¦åŸ·è¡Œã€‚
2. é‹ä½œæ ¸å¿ƒï¼šæŒ‡ä»¤é€±æœŸ (Instruction Cycle) çš„å¾‹å‹•
é€™æ˜¯æœ¬ç¯€æœ€é—œéµçš„å‹•æ…‹è§€é»ã€‚ä¾†æºè³‡æ–™å°‡ CPU çš„é‹ä½œæè¿°ç‚ºä¸€å€‹ä¸æ–·å¾ªç’°çš„æ¨™æº–ä½œæ¥­æµç¨‹ï¼Œç¨±ç‚ºæ©Ÿå™¨é€±æœŸ (Machine Cycle) æˆ–æŒ‡ä»¤é€±æœŸã€‚æ•™æå°‡å…¶æ‹†è§£ç‚ºå››å€‹æ¨™æº–æ­¥é©Ÿï¼š
1. æ“·å– (Fetch)ï¼š
    â—¦ çœ‹æ³•ï¼šé€™æ˜¯é€±æœŸçš„èµ·é»ã€‚CPU å¿…é ˆæ ¹æ“š ç¨‹å¼è¨ˆæ•¸å™¨ (PC) çš„æŒ‡ç¤ºï¼Œå»è¨˜æ†¶é«”æŠŠä¸‹ä¸€æ¢æŒ‡ä»¤ã€ŒæŠ“ã€å›ä¾†ã€‚
    â—¦ å‹•ä½œç´°ç¯€ï¼šå°‡ PC çš„ä½å€å‚³çµ¦ MARï¼Œå†é€éè³‡æ–™åŒ¯æµæ’å°‡æŒ‡ä»¤å‚³çµ¦ MBRï¼Œæœ€å¾Œå­˜å…¥ æŒ‡ä»¤æš«å­˜å™¨ (IR)ã€‚
2. è§£ç¢¼ (Decode)ï¼š
    â—¦ çœ‹æ³•ï¼šé€™æ˜¯ã€Œç†è§£ã€çš„éç¨‹ã€‚æ§åˆ¶å–®å…ƒ (CU) åˆ†æ IR ä¸­çš„æŒ‡ä»¤ï¼Œæ±ºå®šè¦åšä»€éº¼å‹•ä½œï¼ˆä¾‹å¦‚ï¼šæ˜¯åšåŠ æ³•ï¼Ÿé‚„æ˜¯æ¬ç§»è³‡æ–™ï¼Ÿï¼‰ã€‚
3. åŸ·è¡Œ (Execute)ï¼š
    â—¦ çœ‹æ³•ï¼šé€™æ˜¯ã€Œå¯¦è¸ã€çš„éç¨‹ã€‚ALU æ ¹æ“šè§£ç¢¼çµæœé€²è¡Œé‹ç®—ï¼Œæˆ–ç”± CU æŒ‡æ®è³‡æ–™å‚³è¼¸ã€‚
4. å„²å­˜ (Store)ï¼š
    â—¦ çœ‹æ³•ï¼šå°‡é‹ç®—çµæœå¯«å›æš«å­˜å™¨æˆ–è¨˜æ†¶é«”ä¸­ã€‚
æ•™å­¸æ„ç¾©ï¼šä¾†æºè³‡æ–™é€éé€™å€‹é€±æœŸå‘Šè¨´å­¸ç”Ÿï¼Œé›»è…¦ä¸¦ä¸è°æ˜ï¼Œå®ƒåªæ˜¯æ¥µå¿«åœ°é‡è¤‡åŸ·è¡Œã€Œç”±è¨˜æ†¶é«”æ‹¿æŒ‡ä»¤ â†’ çœ‹æ‡‚æŒ‡ä»¤ â†’ åšå‹•ä½œã€é€™ä¸‰å€‹æ­¥é©Ÿã€‚
3. æš«å­˜å™¨ (Registers)ï¼šç¶­æŒã€Œç‹€æ…‹ã€çš„é—œéµ
åœ¨ä¾†æºè³‡æ–™çš„è§€é»ä¸­ï¼Œæš«å­˜å™¨ä¸åƒ…åƒ…æ˜¯å„²å­˜ç©ºé–“ï¼Œå®ƒå€‘æ˜¯CPU é‹ä½œç•¶ä¸‹çš„ã€Œç‹€æ…‹ç´€éŒ„å™¨ã€ã€‚æ²’æœ‰å®ƒå€‘ï¼ŒæŒ‡ä»¤é€±æœŸç„¡æ³•æ¨é€²ã€‚
â€¢ PC (ç¨‹å¼è¨ˆæ•¸å™¨)ï¼šè¢«è¦–ç‚ºæœ€é‡è¦çš„æŒ‡æ¨™ï¼Œæ°¸é æŒ‡å‘**ã€Œä¸‹ä¸€æ¢ã€**è¦åŸ·è¡Œçš„æŒ‡ä»¤ä½å€ã€‚ä¾†æºç‰¹åˆ¥å¼·èª¿ï¼Œç•¶æŒ‡ä»¤è¢« fetch é€² CPU å¾Œï¼ŒPC æœƒè‡ªå‹•åŠ  1ï¼ˆæŒ‡å‘ä¸‹ä¸€æ¢ï¼‰ã€‚
â€¢ IR (æŒ‡ä»¤æš«å­˜å™¨)ï¼šå„²å­˜**ã€Œæ­£åœ¨åŸ·è¡Œã€**çš„æŒ‡ä»¤å…§å®¹ï¼Œä¾› CU è§£ç¢¼ä½¿ç”¨ã€‚
â€¢ MAR & MBR (è¨˜æ†¶é«”ä½å€/ç·©è¡æš«å­˜å™¨)ï¼šè¢«è¦–ç‚º CPU èˆ‡å¤–éƒ¨è¨˜æ†¶é«”æºé€šçš„æ©‹æ¨‘ã€‚CPU ä¸èƒ½ç›´æ¥ä¼¸æ‰‹é€²è¨˜æ†¶é«”ï¼Œå¿…é ˆé€éé€™å…©å€‹æš«å­˜å™¨ä½œç‚ºä»‹é¢ã€‚
â€¢ ç´¯ç©å™¨ (Accumulator)ï¼šè¢«è¦–ç‚ºé‹ç®—çš„ä¸­å¿ƒï¼ŒALU é‹ç®—å¾Œçš„çµæœé€šå¸¸æš«å­˜åœ¨æ­¤ã€‚
4. æŒ‡ä»¤æ ¼å¼ï¼šè»Ÿç¡¬é«”çš„æºé€šå”å®š
ä¾†æºè³‡æ–™å°‡æŒ‡ä»¤ (Instruction) è¦–ç‚ºè»Ÿé«”æ§åˆ¶ç¡¬é«”çš„åª’ä»‹ï¼Œä¸¦åˆ†æäº†æŒ‡ä»¤çš„çµæ§‹ï¼šé‹ç®—ç¢¼ (Opcode) + é‹ç®—å…ƒ (Operand)ã€‚
â€¢ é•·åº¦çš„æ¬Šè¡¡ï¼šæ•™ææ¯”è¼ƒäº†ä¸åŒä½å€æŒ‡ä»¤çš„å„ªåŠ£ï¼š
    â—¦ ä¸‰ä½å€æŒ‡ä»¤ï¼šåŠŸèƒ½å¼·å¤§ï¼ˆA=B+Cï¼‰ï¼Œä½†æŒ‡ä»¤é•·åº¦é•·ï¼Œä½”ç©ºé–“ã€‚
    â—¦ é›¶ä½å€æŒ‡ä»¤ï¼šä¾è³´å †ç–Š (Stack) é‹ä½œï¼Œç¡¬é«”æœ€ç°¡å–®ï¼Œä½†ç¨‹å¼ç¢¼è¡Œæ•¸å¯èƒ½è¼ƒå¤šã€‚
â€¢ çœ‹æ³•ï¼šé€™éƒ¨åˆ†å±•ç¤ºäº†è¨ˆç®—æ©Ÿæ¶æ§‹è¨­è¨ˆä¸­çš„ Trade-offï¼ˆæ¬Šè¡¡ï¼‰â€”â€”è¦åœ¨ã€Œç¡¬é«”è¤‡é›œåº¦ã€èˆ‡ã€ŒæŒ‡ä»¤é•·åº¦/åŸ·è¡Œæ•ˆç‡ã€ä¹‹é–“å–å¾—å¹³è¡¡ã€‚
ç¸½çµ
åœ¨ä¾†æºè³‡æ–™çš„è„ˆçµ¡ä¸­ï¼Œã€ŒCPU æ¶æ§‹èˆ‡æŒ‡ä»¤é€±æœŸã€ä¸åƒ…æ˜¯ç¡¬é«”ä»‹ç´¹ï¼Œå®ƒæ˜¯é›»è…¦ã€Œå¦‚ä½•å‹•èµ·ä¾†ã€çš„è§£é‡‹æ¨¡å‹ã€‚ å®ƒç¢ºç«‹äº†ï¼š
1. çµæ§‹ï¼šCU æŒ‡æ®ï¼ŒALU é‹ç®—ã€‚
2. æµç¨‹ï¼šFetch â†’ Decode â†’ Executeã€‚
3. å·¥å…·ï¼šPC è² è²¬å°èˆªï¼ŒIR è² è²¬ç•¶ä¸‹ï¼ŒMAR/MBR è² è²¬å°å¤–æºé€šã€‚
é€™å¥—é‚è¼¯æ˜¯ç†è§£å¾ŒçºŒã€Œç®¡ç·šåŒ– (Pipelining)ã€æŠ€è¡“ï¼ˆé›–ç„¶æœ¬ç« ç¯€åƒ…ç°¡ç•¥æåŠï¼Œä½†åœ¨é¡Œåº«ä¸­æœ‰å‡ºç¾ï¼‰ä»¥åŠã€Œä¸­æ–·è™•ç†ã€çš„åŸºç¤ã€‚`
        };

        // --- Logic ---

        // Keywords & Weighting (Standard)
        const kwContainer = document.getElementById('keywords-container');
        const kwDetail = document.getElementById('keyword-detail');
        data.keywords.forEach(kw => {
            const btn = document.createElement('button');
            btn.className = 'px-3 py-1 bg-slate-700 hover:bg-primary/50 text-slate-200 text-sm rounded-full transition-colors';
            btn.textContent = kw.term;
            btn.onclick = () => {
                kwDetail.classList.remove('hidden');
                kwDetail.innerHTML = `<strong class="text-secondary">${kw.term}</strong>ï¼š${kw.why_important}<br><span class="text-slate-500 text-xs mt-1 block">ğŸ’¡ è€ƒé»ï¼š${kw.common_exam_angle}</span>`;
            };
            kwContainer.appendChild(btn);
        });

        const wContainer = document.getElementById('weighting-container');
        data.weighting.items.forEach(item => {
            wContainer.innerHTML += `
                <div class="flex items-center gap-4">
                    <div class="w-1/3 text-sm text-slate-300 truncate text-right">${item.topic}</div>
                    <div class="flex-1 h-2 bg-slate-700 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-secondary to-primary" style="width: ${item.weight}%"></div>
                    </div>
                    <div class="text-xs text-slate-500 w-8">${item.weight}%</div>
                </div>`;
        });

        // Matrix
        const matDims = document.getElementById('matrix-dimensions');
        const matBody = document.getElementById('matrix-body');
        const dCols = document.querySelectorAll('.dimension-col');

        data.comparison_matrix.dimensions.forEach((dim, idx) => {
            const btn = document.createElement('button');
            btn.className = `dim-btn px-3 py-1 text-xs rounded-full border border-slate-600 hover:border-secondary transition-all ${idx === 0 ? 'bg-secondary text-white' : 'text-slate-400'}`;
            btn.textContent = dim;
            btn.onclick = () => highlightDim(idx, btn);
            matDims.appendChild(btn);
        });

        function highlightDim(idx, btnClicked) {
            document.querySelectorAll('.dim-btn').forEach(b => {
                b.classList.remove('bg-secondary', 'text-white');
                b.classList.add('text-slate-400');
            });
            btnClicked.classList.add('bg-secondary', 'text-white');
            btnClicked.classList.remove('text-slate-400');

            dCols.forEach(th => {
                if (parseInt(th.dataset.idx) === idx) th.classList.add('text-secondary', 'bg-white/5');
                else th.classList.remove('text-secondary', 'bg-white/5');
            });
            renderRows(idx);
        }

        function renderRows(highlightIdx) {
            matBody.innerHTML = '';
            data.comparison_matrix.rows.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-slate-700/50 hover:bg-white/5 transition-colors cursor-pointer';
                let cells = `<td class="p-4 font-bold text-white">${row.name}</td>`;
                data.comparison_matrix.dimensions.forEach((dim, idx) => {
                    const isHighlight = idx === highlightIdx;
                    cells += `<td class="p-4 transition-colors ${isHighlight ? 'text-white bg-white/5 font-medium' : 'text-slate-400'}">${row.values[dim]}</td>`;
                });
                tr.innerHTML = cells;

                const detailRow = document.createElement('tr');
                detailRow.className = 'hidden bg-slate-800/50 text-sm';
                detailRow.innerHTML = `<td colspan="5" class="p-4"><div class="flex gap-6"><div class="flex-1 text-yellow-500">âš ï¸ ${row.pitfall}</div><div class="flex-1 text-green-400">ğŸ’¡ ${row.rule_of_thumb}</div></div></td>`;

                tr.onclick = () => detailRow.classList.toggle('hidden');
                matBody.appendChild(tr);
                matBody.appendChild(detailRow);
            });
        }
        renderRows(0);

        // Core Lab: Simulator
        let pc = 0;
        const steps = ['step-fetch', 'step-decode', 'step-execute', 'step-store'];
        let currentStepIdx = -1;
        let isRunning = false;

        async function runCycle() {
            if (isRunning) return;
            isRunning = true;
            currentStepIdx = 0;
            const msg = document.getElementById('cycle-msg');

            // 1. Fetch
            msg.textContent = "1. Fetch: æ ¹æ“š PC æŠ“å–æŒ‡ä»¤...";
            updateActiveStep(0);
            await wait(800);
            document.getElementById('ir-val').textContent = `INST_${pc}`;

            // 2. Decode
            msg.textContent = "2. Decode: åˆ†æ Opcode...";
            updateActiveStep(1);
            await wait(800);

            // 3. Execute
            msg.textContent = "3. Execute: ALU é€²è¡Œé‹ç®—...";
            updateActiveStep(2);
            await wait(800);

            // 4. Store
            msg.textContent = "4. Store: å¯«å›çµæœä¸¦æ›´æ–° PC...";
            updateActiveStep(3);
            await wait(800);

            // Update PC
            pc++;
            document.getElementById('pc-val').textContent = pc.toString().padStart(2, '0');
            document.getElementById('ir-val').textContent = 'EMPTY';
            clearSteps();
            msg.textContent = "æŒ‡ä»¤é€±æœŸå®Œæˆã€‚ç­‰å¾…ä¸‹ä¸€æŒ‡ä»¤ã€‚";
            isRunning = false;
        }

        function updateActiveStep(idx) {
            clearSteps();
            document.getElementById(steps[idx]).classList.add('active');
        }

        function clearSteps() {
            steps.forEach(s => document.getElementById(s).classList.remove('active'));
        }

        function wait(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }


        // Mistakes
        const mistContainer = document.getElementById('mistakes-container');
        data.core_concept_lab.common_mistakes.forEach(m => {
            mistContainer.innerHTML += `<div class="p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-sm"><strong class="text-red-300 block mb-1">âŒ ${m.mistake}</strong><span class="text-slate-400">${m.why_wrong}</span><div class="mt-2 text-green-400 text-xs">âœ… ${m.how_to_fix}</div></div>`;
        });

        // Flashcards
        const fcContainer = document.getElementById('flashcards-container');
        data.flashcards.forEach(fc => {
            const card = document.createElement('div');
            card.className = 'flip-card h-40';
            card.innerHTML = `<div class="flip-card-inner bg-surface rounded-lg shadow border border-slate-700"><div class="flip-card-front flex-col"><span class="text-secondary font-bold text-lg">${fc.front}</span><span class="text-xs text-slate-500 mt-2">(é»æ“Šç¿»é¢)</span></div><div class="flip-card-back bg-gradient-to-br from-primary to-blue-700 rounded-lg text-white text-sm px-2">${fc.back}</div></div>`;
            card.onclick = () => card.classList.toggle('flipped');
            fcContainer.appendChild(card);
        });

        // Scenarios
        const scContainer = document.getElementById('scenarios-container');
        data.scenario_checks.forEach((sc, idx) => {
            const div = document.createElement('div');
            div.className = 'p-4 bg-slate-800 rounded-lg border border-slate-700';
            div.innerHTML = `<p class="text-slate-300 mb-4 font-medium"><span class="text-primary mr-2">Q${idx + 1}.</span>${sc.statement}</p><div class="flex gap-3 mb-3"><button class="btn-ans w-12 h-12 rounded-full border-2 border-slate-600 hover:border-green-500 hover:text-green-500 font-bold" data-ans="O">O</button><button class="btn-ans w-12 h-12 rounded-full border-2 border-slate-600 hover:border-red-500 hover:text-red-500 font-bold" data-ans="X">X</button></div><div class="feedback hidden p-3 rounded bg-slate-700 text-sm"></div>`;

            div.querySelectorAll('.btn-ans').forEach(btn => btn.onclick = () => {
                const fb = div.querySelector('.feedback');
                fb.classList.remove('hidden', 'bg-green-900/50', 'bg-red-900/50', 'text-green-300', 'text-red-300');
                if (btn.dataset.ans === sc.answer) {
                    fb.classList.add('bg-green-900/50', 'text-green-300');
                    fb.innerHTML = `<strong>æ­£ç¢ºï¼</strong> ${sc.explanation}`;
                } else {
                    fb.classList.add('bg-red-900/50', 'text-red-300');
                    fb.innerHTML = `<strong>éŒ¯èª¤ã€‚</strong> ${sc.explanation}`;
                }
            });
            scContainer.appendChild(div);
        });

        // Appendix
        document.getElementById('accordion-btn').onclick = () => {
            document.getElementById('accordion-content').classList.toggle('hidden');
            document.getElementById('accordion-icon').classList.toggle('rotate-180');
        };
        document.getElementById('raw-notes-content').textContent = data.original_notes_for_appendix;

    </script>
</body>

</html>